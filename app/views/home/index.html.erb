<style>
  .product-card {
      position: relative;
      box-shadow: 0px 0 32px rgb(1 41 112 / 8%);
      margin: 50px auto;
      background: #e6e6e6;
      border: 0.5px solid #e2e1e1;
  }
  .product-card:hover {
    transform: scale(1.05) !important;
  }
.product_listing{
  height: 100%;
}

.product_listing .product-img {
    width: 100%;
    height: 200px;
}
  .badge {
      position: absolute;
      left: 0;
      top: 20px;
      text-transform: uppercase;
      font-size: 13px;
      font-weight: 700;
      background: #6e6e6e;
      color: #bcfd4c;
      padding: 3px 10px;
  }

    .product-tumb {
      display: flex;
      align-items: center;
      justify-content: center;
      height: 200px;
      padding: 0; 
      background: white;
      overflow: hidden;
  }

  .product-tumb a{
      display: flex;
      align-items: center;
      justify-content: center;
      width: 100%; 
      height: 100%; 
  }

  .product-tumb img {
      width: 100%; 
      height: 100%; 
      object-fit: cover; 
  }

  .product-details {
      padding: 30px;
  }

  .product-catagory {
      display: block;
      font-size: 12px;
      font-weight: 700;
      text-transform: uppercase;
      color: darkblue;
      margin-bottom: 18px;
  }

  .product-details h4 {
    text-align: center;
    color: black;
  }

  .product-details h4 a {
      font-weight: 500;
      display: block;
      margin-bottom: 18px;
      text-transform: uppercase;
      text-decoration: none;
      transition: 0.3s;
      color: #433f3f;
  }

  .product-details h4 a:hover {
      color: #F52544;
  }

  .product-details p {
      font-size: 15px;
      line-height: 22px;
      margin-bottom: 18px;
      color: white;
  }

  .product-bottom-details {
      overflow: hidden;
      border-top: 1px solid #99ddff;
      padding-top: 20px;
  }

  .product-bottom-details div {
      float: left;
      width: 50%;
  }

  .product-price {
      font-size: 18px;
      color: #433f3f;
      font-weight: 600;
  }

  .product-price small {
      font-size: 80%;
      font-weight: 400;
      text-decoration: line-through;
      display: inline-block;
      margin-right: 5px;
  }

  .product-links {
      text-align: right;
  }

  .product-links a {
      display: inline-block;
      margin-left: 5px;
      color: #f29f37 !important;
      transition: 0.3s;
      font-size: 17px;
  }

  .product-links a:hover {
      color: #F52544;
  }
/* view more button styling  */
.title-row {
    display: flex;
    flex-direction: row;
    justify-content: space-between;
    align-items: baseline;
}
.view_more_btn{
      display: flex;
    flex-direction: row;
    justify-content: space-between;
    width: 100px;
    align-items: center;

}
a.taxonomy-links {
    text-decoration: none;
    color: black;
}

.card.product_listing:hover {
    transform: scale(1.03);
}
.product_row{
  margin-bottom: 60px;
}

@media screen and (max-width: 767px){
  .product_listing .product-img {
    width: 100%;
    height: 150px;
}
.product_row{
  margin-bottom: 40px;
}
}

</style>
<%= render 'hero' %>


<div class="container mb-5 mt-5 px-4">
    <% displayed_products = Set.new %>
    <% Spree::Taxonomy.all.each do |taxonomy| %>
      <% products_present = false %>
      <% taxonomy&.root&.taxonomy&.taxons&.each do |taxon| %>
        <% if taxon&.products&.any? %>
          <% products_present = true %>
          <% break %>
        <% end %>
      <% end %>
      
      <% if products_present %>
      <div class="title-row mb-4"><h2 style="font-size: 3em; font-weight: 500;"><%= taxonomy.name %></h2> 
          <% taxonomy.root.taxonomy.taxons.each do |taxon| %>
        <% if taxon.products.count > 4 %>   
          <% taxonomy_permalink = taxonomy.taxons.where(name: taxonomy.name)&.first&.permalink%>
          <%= link_to "/t/#{taxonomy_permalink}", class: "taxonomy-links" do %>
              <h4 class="view_more_btn">
                View More
                  <i class="fa fa-arrow-right"></i>
              </h4>
          <%end%>
          <%end%>
          <%end%>
      </div>
        <div class="row product_row row-cols-2 row-cols-md-3 row-cols-lg-4 g-4">
        <% displayed_count = 0 %>
        <% taxonomy&.root&.taxonomy&.taxons&.each do |taxon| %>
          <% taxon&.products&.each do |product| %>
            <% unless displayed_products.include?(product.id) %>
              <% displayed_products.add(product.id) %>
              <% displayed_count += 1 %>
              <% if displayed_count <= 4 %>
                <div class="col">
                  <div class="card product_listing" style="border-radius: 15px;">
                    <div class="bg-image hover-overlay ripple ripple-surface ripple-surface-light"
                      data-mdb-ripple-color="light">
                        <%= link_to product_path(product), itemprop: 'url' do %>
                          <%= render(ImageComponent.new(image: product.gallery.images.first, size: :small, itemprop: "image", style:"border-top-left-radius: 15px; border-top-right-radius: 15px;", class:"product-img", alt:"product-listing")) %>
                        <% end %>
                      <a href="#!">
                        <div class="mask"></div>
                      </a>
                    </div>
                    <div class="card-body pb-0">
                      <div class="d-flex justify-content-between">
                        <div>
                          <h5><%= product.name  %></h5>
                          <div class="d-flex flex-row">
                            <div class="dot"></div>
                            <div class="mt-1 mb-1 spec-1">
                              <% product.stores.each do |store| %>
                                <%= store.name %>
                              <% end %>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                    <hr class="my-0" />
                    <div class="card-body pb-0">
                      <div class="d-flex justify-content-between">
                        <div class="d-flex flex-row justify-content-end mt-1 mb-4" style="color: orange;">
                          <i class="fas fa-star"></i>
                          <i class="fas fa-star"></i>
                          <i class="fas fa-star"></i>
                          <i class="fas fa-star"></i>
                          <i class="fas fa-star"></i>
                        </div>
                        <h5 class="large text-muted">$ <%= product.price %></h5>
                      </div>
                    </div>
                    <hr class="my-0" />
                    <div class="card-body">
                      <div class="d-flex justify-content-between align-items-center pb-2 mb-1">
                        <% if Current.spree_user %>
                          <% fav_product = Favorite.find_by(user_id: Current.spree_user&.id, product_id: product&.id) %>
                          <% if !fav_product&.present? %>
                            <%= render partial: 'products/add_to_favroite_partial', locals: {product: product} %>
                          <% else %>
                            <%= render partial: 'products/remove_from_favroite_partial', locals: {product: product} %>
                          <% end %>
                        <% end %>
                        <%= link_to product_path(product), itemprop: 'url', type:"button", class:"btn btn-primary px-4" do %>
                          View
                        <% end %>  
                      </div>
                    </div>
                  </div>
              </div>
              <% end %>
            <% end %>
          <% end %>
        <% end %>
      </div>
    <% end %>
  <% end %>
</div>


<div class="container d-flex justify-content-center mb-5">
<a href="/" >
  <%= image_tag("bookarley-logo.png", alt: "Logo", width: 120) %>
  </a>
</div>