<style>
  .dropdown-menu-width {
    width: 91%;
    margin-left: 20px;
  }

  .circle-image {
    width: 40px;
    height: 40px;
    border: 0.5px solid lightgray;
    border-radius: 50%;
    object-fit: cover;
    z-index: 1;
  }
  
  .all-cat-dropdown{
    margin-bottom: -5px;
    margin-top: 5px;
    margin-right: 10px;
    margin-left: 20px;
    background: white;
    width: 300px;
    padding-top: 15px !important;
    padding-bottom: 15px !important;
    border-top-left-radius: 5px !important;
    border-top-right-radius: 5px !important;
    border-bottom-right-radius: 0px !important;
    border-bottom-left-radius: 0px !important;
    font-weight: bold;
  }
  .dropdown-toggle::after {
    display: none;
  }

  .all-ctg-text{
    float: left;
    color: black;
    font-weight: 500;
    margin-left: 25px;
    font-size: 1.3rem;
  }

  .ctg-list-text{
    color: black;
    font-weight: 500;
    margin-left: 25px;
    font-size: 1.35rem;
  }

  .all-ctg-icon{
    float: right;
    color: black;
    margin-top: 6px;
    margin-right: 11px;
  }

  .navbar-nav .nav-gap {
    margin-right: 5px;
  }

  .dropbtn {
    padding: 16px;
    border: none;
    cursor: pointer;
  }

  .taxonomy-link:hover{
    background: #ECEEF2;
    border-left: 8px solid #F29F37;
  }

  .dropdown {
    position: relative;
    display: inline-block;
  }

  .dropdown-content {
    display: none;
    position: absolute;
    background-color: white;
    box-shadow: 0px 8px 8px 0px rgba(0,0,0,0.2);
    z-index: 1;
  }

  .dropdown-content a {
    color: black;
    padding: 12px 16px;
    text-decoration: none;
    display: block;
    font-size: 1.2em;
  }

  .show {display:block;}

  .custom-dropdown {
    position: relative;
    display: inline-block;
  }
  
  .dropdown-content-unique {
    display: none;
    position: absolute;
    background-color: #f9f9f9;
    min-width: 160px;
    box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.2);
    z-index: 1;
    right: 0px;
    top: 38px;
    cursor: pointer;
  }
  
  .custom-dropdown:hover .dropdown-content-unique {
    display: block;
  }

  .profile-dropdown{
    display: flex;
    flex-direction: column;
    font-size: 1em;
  }

  .taxonomy-dropdown {
    position: relative;
    display: inline-block;
  }

 .taxonomy-dropdown a {
    text-decoration: none;
    color: white;
  }

  .taxonomy-name{
    cursor: pointer;
  }

  .taxonomy-dropdown-content {
    display: none;
    position: fixed;
    background-color: #f9f9f9;
    box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.2);
    z-index: 1;
    width: 90%;
    right: 0;
    left: 65px;
    border-radius: 8px;
  }
  .taxonomy-dropdown-content a {
    color: black;
  }

  .taxonomy-dropdown:hover .taxonomy-dropdown-content {
    display: block;
    border-bottom: 10px solid #F29F37;
  }

  .taxonomy-name:hover{
    border-bottom: 2px solid #F29F37;
  }
  
  .parent-taxon {
    padding: 10px;
    color: #1e396b;
    font-size: 1.1em;
  }
  
 .taxonomy-dropdown-all .child-taxons a {
    padding: 0px 16px;
  }

  .child-taxons-name {
    color: #4f4d4d;
    font-weight: 300;
    font-size: 0.9em;
  }

  .child-taxons-name:hover{
    color: #1e396b;
    cursor: pointer;
  }

  .child-taxons span {
    display: block;
  }

  .taxonomy-dropdown-all {
    display: none;
    position: fixed;
    background-color: white;
    box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.2);
    z-index: 1;
    width: 74.5%;
    right: 0;
    top: 132px;
    left: 326px;
  }

  .dropdown-wrapper:hover .taxonomy-dropdown-all {
    display: block;
    border-bottom: 10px solid #F29F37;
  }

  .parent-taxon .taxon_name a{
    padding: 0px 16px;
  }

  .register-profile-dropdown {
    position: relative;
    display: inline-block;
  }

  .register-profile-button {
    display: flex;
    align-items: center;
    cursor: pointer;
    z-index: 9;
  }

  .register-profile-button img {
    width: 40px;
    height: 40px;
    border-radius: 50%;
    margin-right: 10px;
  }

  .register-dropdown-content {
    display: none;
    position: absolute;
    background-color: #f9f9f9;
    box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.2);
    z-index: 1;
    top: 50px;
    right: 0;
    width: 200px;
    padding-top: 20px;
  }

  .register-dropdown-content a {
    display: block;
    padding: 10px 20px;
    text-decoration: none;
    color: #333;
    transition: background-color 0.3s;
  }

  .register-dropdown-content a:hover {
    background-color: #ddd;
    border-left: 8px solid #F29F37;
      
  }

  .register-profile-dropdown-mobile {
    position: relative;
    display: inline-block;
  }

  .register-profile-button-mobile {
    display: flex;
    align-items: center;
    cursor: pointer;
    z-index: 9;
  }

  .register-profile-button-mobile img {
    width: 40px;
    height: 40px;
    border-radius: 50%;
    margin-right: 10px;
  }

  .register-dropdown-content-mobile {
    display: none;
    position: absolute;
    background-color: #f9f9f9;
    box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.2);
    z-index: 1;
    top: 46px;
    right: 0;
    width: 200px;
    padding-top: 20px;
  }

  @media(max-width: 574px){
    .register-dropdown-content-mobile{
      top: 16px !important;
    }
  }

  .register-dropdown-content-mobile a {
    display: block;
    padding: 10px 20px;
    text-decoration: none;
    color: #333;
    transition: background-color 0.3s;
  }

  .register-dropdown-content-mobile a:hover {
    background-color: #ddd;
    border-left: 8px solid #F29F37;
      
  }

  .profile-icons{
    margin-right: 3px;
  }

  @media(min-width: 992px){
    .mobile-nav-visible{
      display: none;
    }
  }

  @media(width: 992px){
    .mobile-nav-visible{
      display: block;
    }
  }

  @media(max-width: 992px){
    .mobile-nav-hidden{
      display: none;
    }
  }
  @media screen and (min-width: 993px){
.mobile-sidebar.active{
  display: none;
}
.mobile-sidebar{
  display: none;
}
}

  .mobile-sidebar {
    width: 280px;
    height: 100%;
    position: fixed;
    left: -280px;
    background: linear-gradient(to bottom, #1c396b 30%, white 30%);
    transition: left 0.3s ease-in-out;
    box-shadow: 0px 0px 10px rgba(0, 0, 0, 0.1);
    z-index: 9;
    margin-top: 70px;

  }

  .mobile-sidebar.active {
    left: 0;
  }

  .no-scroll {
    overflow: hidden;
  }
  .sidebar-content {
    max-height: calc(80vh - 70px);
    overflow-y: auto;
    border-radius: 10px;
  }


  /* Taxonomy Dropdown styles */
  .taxonomy-dropdown-toggle {
    width: 100%;
    text-align: left;
    padding: 15px;
    background-color: #ffffff;
    border: none;
    cursor: pointer;
    outline: none;
    align-items: center;
    color: #232020;
    font-weight: 600;
    font-size: 1.3em;
  }

  .taxonomy-dropdown-toggle i {
    transition: transform 0.3s;
  }

  .parent-taxon-dropdown {
    max-height: 0;
    overflow: hidden;
    transition: max-height 0.3s ease-in-out;
  }

  .parent-taxon-list {
    margin-top: 10px;
    padding-left: 20px;
  }

  /* Parent Taxon styles */
  .parent-taxon-item {
    list-style: none;
    border-left: 5px solid orange;
    color: #232020;
  }

  .parent-taxon-item button.taxonomy-dropdown-toggle {
      font-size: 1.3em;
      font-weight: 500;
  }

  .child-taxon-item {
    padding-top: 8px;
    padding-bottom: 8px;
  }

  .child-taxon-item a{
    text-decoration: none;
    color: #232020;
    font-weight: 400;
    font-size: 1.2em;
  }

  .child-taxon-dropdown {
    max-height: 0;
    overflow: hidden;
    transition: max-height 0.3s ease-in-out;
    padding-left: 10px;
    background: white;
  }

  .child-taxon-list {
    margin-top: 5px;
    margin-bottom: 5px;
  }

  /* Show dropdowns when toggled */
  .show {
    max-height: 1000px;
  }
  .sidebar-user{
    width: 60px;
    height: 54px;
    padding: 5px;
    /* background: #f6f6f6; */
    margin-top: 20px;
    margin-left: 20px;
    border-radius: 50%;

  }
  .sidebar-user .user_profile{
    border-radius: 50%; 
    border: 3px solid lightgray;
    height: 50px;
    width: 50px;
  }
  .user_email{
    position: absolute;
    top: 62px;
  }
.top_nav_user_img {
    border-radius: 50%;
    height: 50px;
    width: 50px;
    border: 3px solid lightgray;
}
.default_img {
    border-radius: 50%;
    height: 50px;
    width: 50px;
}


</style>

<nav class="navbar navbar-expand-sm navbar-light bg-white py-3 px-5 fixed-top mobile-nav-hidden" style="z-index: 100;">
  <div class="container-fluid">
      <%= link_to root_path do %>
        <a href="/" class="navbar-brand"><%= image_tag("bookarley-logo.png", alt: "Logo", width: 60) %></a>
      <% end %>
      <button type="button" class="navbar-toggler" data-bs-toggle="collapse" data-bs-target="#navbarCollapse">
          <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse justify-content-between" id="navbarCollapse">
          <%= render 'shared/search/search_bar', class:"mx-auto", taxons: taxons, taxon: taxon %>
          <div class="navbar-nav">
          <% if spree_current_user %>
             <div class="btn-group d-flex justify-content-center align-items-center" style="cursor: pointer;" id="profile-section">
                 <% if spree_current_user&.profile&.attached? %>
                      <%= image_tag request.base_url + url_for(spree_current_user.profile), class:"top_nav_user_img", alt: "...", width: 40 %>
                    <% else %>
                    <%= image_tag('user_profile_icon.png', class: "circle-image") %>
                  <% end %>
                <div>
                  <i class="fa fa-angle-down" style="padding-left: 5px; font-size: 1.2em;"></i>
                </div>
            </div>
            
            <div class="register-profile-dropdown">
              <div class="register-dropdown-content shadow" id="registerDropdownContent">
                 <div class="d-flex justify-content-center">
                      <% if spree_current_user&.profile&.attached? %>
                        <%= image_tag request.base_url + url_for(spree_current_user.profile), class:"top_nav_user_img", alt: "...", width: 40 %>
                        <% else %>
                        <%= image_tag('user_profile_icon.png', class: "circle-image") %>
                      <% end %>
                  </div>
                <div class="d-flex justify-content-center" style="font-size: 1.3em; padding: 3px; color: #1e396b; font-weight: 400;">
                  <div><%= spree_current_user.email %></div>
                </div>
                <hr style="color: #b5b1b1;">
                <%= link_to raw('<i class="fas fa-user profile-icons"></i> ' + I18n.t('my_account')), account_path, class: 'text-dark my-3', style: "font-size: 1.1em;" %>
                <a href="/admin/orders" class= 'text-dark mb-3', style= "font-size: 1.1em;"> <i class="fas fa-cogs profile-icons"></i> Admin Dashboard </a>
                <a href="<%= blog_posts_path %>" class= 'text-dark mb-3', style= "font-size: 1.1em;"> <i class="fa fa-newspaper profile-icons"></i> Manage Blogs </a>
                <%= link_to raw('<i class="fas fa-sign-out-alt profile-icons"></i> ' + I18n.t('spree.logout')), destroy_spree_user_session_path, method: :delete, class: 'text-danger mb-3', style: "font-size: 1.1em;" %>  
              </div>
            </div>
          <% else %>
            <div class="btn-group d-flex justify-content-center align-items-center" style="cursor: pointer;" type="button" data-bs-toggle="modal" data-bs-target="#exampleModal">
                <%= image_tag('user_profile_icon.png', class: "circle-image") %>
                <div>
                  <i class="fa fa-angle-down" style="padding-left: 5px; font-size: 1.2em;"></i>
                </div>
            </div>
          <% end %>  
          </div>
      </div>
  </div>
</nav>

<nav class="navbar navbar-expand-sm navbar-light bg-white py-3 fixed-top mobile-nav-visible" style="z-index: 100;">
    <div class="container-fluid">
      <div class="navbar-nav mr-auto">
        <button class="btn btn-link" id="sidebarToggle">
            <svg width="50" height="18" viewBox="0 0 50 30" xmlns="http://www.w3.org/2000/svg">
              <rect width="28" height="5" rx="4" fill="#203b6d"/> 
              <rect y="10" width="38" height="5" rx="4" fill="#203b6d"/>
              <rect y="20" width="50" height="5" rx="4" fill="#203b6d"/>
            </svg>
        </button>
      </div>
      <div class="navbar-nav mx-auto">
        <%= link_to root_path, style:"margin-left: 20px !important;" do %>
          <div class="navbar-brand"><%= image_tag("bookarley-logo.png", alt: "Logo", width: 60) %></div>
        <% end %>
      </div>
      <div class="navbar-nav ml-auto">
        <% if spree_current_user %>
          <div class="btn-group d-flex justify-content-center align-items-center" style="cursor: pointer;" id="profile-section-mobile">
            <% if spree_current_user&.profile&.attached? %>
                <%= image_tag request.base_url + url_for(spree_current_user.profile), class:"top_nav_user_img", alt: "...", width: 40 %>
              <% else %>
                <%= image_tag('user_profile_icon.png', class: "circle-image") %>
            <% end %>
              <div>
                <i class="fa fa-angle-down" style="padding-left: 5px; font-size: 1.2em;"></i>
              </div>
          </div>
          
          <div class="register-profile-dropdown-mobile">
            <div class="register-dropdown-content-mobile shadow" id="registerDropdownContent">
              <div class="d-flex justify-content-center">
                <div>
                 <% if spree_current_user&.profile&.attached? %>
                <%= image_tag request.base_url + url_for(spree_current_user.profile), class:"top_nav_user_img", alt: "...", width: 40 %>
              <% else %>
                <%= image_tag('user_profile_icon.png', class: "circle-image") %>
            <% end %>
                </div>
              </div>
              <div class="d-flex justify-content-center" style="font-size: 1.3em; padding: 3px; color: #1e396b; font-weight: 400;">
                <div><%= spree_current_user.email %></div>
              </div>
              <hr style="color: #b5b1b1;">
              <%= link_to raw('<i class="fas fa-user profile-icons"></i> ' + I18n.t('my_account')), account_path, class: 'text-dark my-3', style: "font-size: 1.1em;" %>
              <a href="/admin/orders" class= 'text-dark mb-3', style= "font-size: 1.1em;"> <i class="fas fa-cogs profile-icons"></i> Admin Dashboard </a>
              <a href="<%= blog_posts_path %>" class= 'text-dark mb-3', style= "font-size: 1.1em;"> <i class="fa fa-newspaper profile-icons"></i> Manage Blogs </a>
              <%= link_to raw('<i class="fas fa-sign-out-alt profile-icons"></i> ' + I18n.t('spree.logout')), destroy_spree_user_session_path, method: :delete, class: 'text-danger mb-3', style: "font-size: 1.1em;" %>  
            </div>
          </div>
        <% else %>
          <div class="btn-group d-flex justify-content-center align-items-center" style="cursor: pointer;" type="button" data-bs-toggle="modal" data-bs-target="#exampleModal">
              <%= image_tag('user_profile_icon.png', class: "circle-image") %>
              <div>
                <i class="fa fa-angle-down" style="padding-left: 5px; font-size: 1.2em;"></i>
              </div>
          </div>
        <% end %>  
      </div>
    </div>  
  </div>
</nav>

<%= render 'layouts/ctg_top_bar' %>

<%= render 'layouts/login_modal' %>

<div class="mobile-sidebar" id="mobile-sidebar">
  <% if spree_current_user %>
    <div class="d-flex">
      <div class="d-flex justify-content-right sidebar-user mb-5">
         <% if spree_current_user&.profile&.attached? %>
          <%= image_tag request.base_url + url_for(spree_current_user.profile), alt: "...",class: "user_profile", width: 40 %>
        <% else %>
           <%= image_tag("user_profile_icon.png", alt: "Logo", class:"default_img", width: 40) %>
        <% end %>
      </div>
      <div class="d-flex justify-content-center align-items-center user_email" style="font-size: 1.5em; padding: 15px; color: white; font-weight: 400;">
        <div><%= spree_current_user.email %></div>
      </div>
    </div> 
  <% end %>
  <div class="mx-3">
    <div class="sidebar-content">
      <% Spree::Taxonomy.all.each do |taxonomy| %>
        <div class="taxonomy-item">
          <button class="taxonomy-dropdown-toggle" onclick="toggleTaxonomy(this)">
            <% if taxonomy.icon.attached? %>
              <%= render(ImageComponent.new(image: taxonomy.icon, size: :small, itemprop: "image", style: "width: 20px; margin-right: 6px;")) %>
            <% end %>
            <span><%= taxonomy.name %></span>
            <span style="float: right;"><i class="fas fa-chevron-right"></i></span>
          </button>
          
          <div class="parent-taxon-dropdown">
            <% parent_taxons = taxonomy&.root&.children %>
            <% if parent_taxons&.any? %>
              <ul class="parent-taxon-list">
                <% parent_taxons.each do |parent_taxon| %>
                  <li class="parent-taxon-item">
                    <button class="taxonomy-dropdown-toggle" onclick="toggleTaxonomy(this)">
                      <span><%= parent_taxon.name %></span>
                      <span style="float: right;"><i class="fas fa-chevron-right"></i></span>
                    </button>
                    <div class="child-taxon-dropdown">
                      <% child_taxons = parent_taxon.children %>
                      <% if child_taxons.any? %>
                        <ul class="child-taxon-list">
                          <% child_taxons.each do |child_taxon| %>
                            <li class="child-taxon-item">
                              <%= link_to "/t/#{child_taxon.permalink}" do %>
                                <%= child_taxon.name %>
                              <% end %>
                            </li>
                          <% end %>
                        </ul>
                      <% end %>
                    </div>
                  </li>
                <% end %>
              </ul>
            <% end %>
          </div>
        </div>
      <% end %>
    </div>
  </div>
</div>

<script>
  function toggleTaxonomy(button) {
    const parentTaxonDropdown = button.nextElementSibling;
    parentTaxonDropdown.classList.toggle("show");
    const icon = button.querySelector("i");
    icon.classList.toggle("fa-chevron-right");
    icon.classList.toggle("fa-chevron-down");
  }
</script>
<script>
  function ctgDropDown() {
    document.getElementById("myDropdown").classList.toggle("show");
  }

  // Close the dropdown menu if the user clicks outside of it
  window.onclick = function(event) {
    if (!event.target.matches('.dropbtn')) {
      var dropdowns = document.getElementsByClassName("dropdown-content");
      var i;
      for (i = 0; i < dropdowns.length; i++) {
        var openDropdown = dropdowns[i];
        if (openDropdown.classList.contains('show')) {
          openDropdown.classList.remove('show');
        }
      }
    }
  }

  $(document).ready(function() {
      $("#profile-section-mobile").click(function() {
          $(".register-dropdown-content-mobile").toggle();
      });

      $("#profile-section").click(function() {
          $(".register-dropdown-content").toggle();
      });

      $(document).click(function(event) {
          if (!$(event.target).closest(".btn-group, .register-dropdown-content").length) {
              $(".register-dropdown-content").hide();
          }

          if (!$(event.target).closest(".btn-group, .register-dropdown-content-mobile").length) {
              $(".register-dropdown-content-mobile").hide();
          }
      });
  });

  document.addEventListener("DOMContentLoaded", function() {
    const sidebarToggle = document.getElementById("sidebarToggle");
    const sidebar = document.getElementById("mobile-sidebar");
    const body = document.body;

      sidebarToggle.addEventListener("click", function() {
        sidebar.classList.toggle("active");
        body.classList.toggle("no-scroll");
      });
  });

</script>